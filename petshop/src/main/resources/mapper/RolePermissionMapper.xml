<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.petshop.mapper.RolePermissionMapper">

    <!-- 通用字段映射 -->
    <resultMap id="BaseResultMap" type="com.petshop.entity.RolePermission">
        <result column="role_code" property="roleCode" />
        <result column="perm_code" property="permCode" />
    </resultMap>

    <!-- 根据复合主键查询 -->
    <select id="selectByCompositeKey" resultMap="BaseResultMap">
        SELECT *
        FROM role_permission
        WHERE role_code = #{roleCode}
          AND perm_code = #{permCode}
    </select>

    <!-- 检查记录是否存在 -->
    <select id="exists" resultType="boolean">
        SELECT COUNT(*) > 0
        FROM role_permission
        WHERE role_code = #{roleCode}
          AND perm_code = #{permCode}
    </select>

    <!-- 根据角色编码查询权限列表 -->
    <select id="selectPermissionsByRoleCode" resultType="java.lang.String">
        SELECT perm_code
        FROM role_permission
        WHERE role_code = #{roleCode}
    </select>

    <!-- 删除角色-权限关联 -->
    <delete id="deleteByRoleAndPerm">
        DELETE FROM role_permission
        WHERE role_code = #{roleCode}
          AND perm_code = #{permCode}
    </delete>

</mapper>